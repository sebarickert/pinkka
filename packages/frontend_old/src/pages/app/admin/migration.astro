---
import RootAuthenticatedLayout from "@/layouts/RootAuthenticatedLayout.astro";
import { authClient } from "@/lib/auth-client";

// const { data: users, error } = await authClient.admin.listUsers({
//   fetchOptions: { headers: Astro.request.headers },
// });

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();

    const file = data.get("migrationFile");
    if (!file || !(file instanceof File)) {
      throw new Error("No file uploaded");
    }

    const formData = new FormData();
    formData.append("document", file);

    const response = await fetch(
      `http://localhost:3000/api/migrations/financer`,
      {
        method: "POST",
        body: formData,
        headers: {
          //   "Content-Type": "application/json",
          Cookie: Astro.request.headers.get("cookie") || "",
        },
      }
    );

    const body = await response.json();
    console.log(body);
  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
---

<RootAuthenticatedLayout title="Migration">
  <form id="migration/financer" method="POST" enctype="multipart/form-data">
    <input type="file" name="migrationFile" accept=".json" />
    <button>Upload</button>
  </form>
</RootAuthenticatedLayout>
